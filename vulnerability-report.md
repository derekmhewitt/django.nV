# Vulnerability Report
Reviewer 1: Derek Hewitt

Reviewer 2: David Banks

Date: October 21st, 2016

## Reviewing Django nV Site

https://github.com/Break-Django/django.nV

## V1: SQL Code Injection
###Exposure
We found an instance of vulnerability to SQL code injection in the Task Manager app located at: /taskManager/2/upload/.
We exploited this vulnerability by injecting the following code:

somePicture',(SELECT * FROM *);

This vulnerability would be exposed by any valid SQL queries input into the file upload text box.

By exploiting SQL Code Injection on this site we would be able to retrieve information on user accounts (names, email addresses, hashed passwords) and copies of any data stored in the database.

###Repair
The vulnerability is caused by the following code in views.py:
```
curs = connection.cursor()
            curs.execute(
                "insert into taskManager_file ('name','path','project_id') values ('%s','%s',%s)" %
                (name, upload_path, project_id))
```

This exploit could be repaired by replacing the above code with code similar to the following:

views.py
```
    file = File(name=name, path=upload_path, project_id=project_id)
    file.save()
```

## V2: Broken Authentication and Session Management
### Exposure
We found an instance of broken authentication by forging a valid user request with the is_superuser flag set to True on the account creation page.  Because the site used an incomplete whitelist instead of a blacklist of user account form fields they forgot to exclude is_superuser.

By exploiting the site's broken authentication we're able to create a superuser account which then has admin level access to all the information on the site itself.  It's pretty obviously bad if someone can do that from your account sign up page.

### Repair
The vulnerability is caused by the following code in forms.py:
```
class UserForm(forms.ModelForm):
    """ User registration form """
    class Meta:
        model = User
        exclude = ['groups', 'user_permissions', 'last_login', 'date_joined', 'is_active']
```

It would be easy for anyone to forget to exclude an important field in a blacklist, therefore it's better practice to use a whitelist and explicitly add only safe form fields to that whitelist.

Some example code that would solve our problem (and replace the above code) would look like in forms.py:
```
class UserForm(forms.ModelForm):
    """User registration form here"""
    class Meta:
        model = User
        include = ['username', 'password', 'email']
```
We want the absolute minimum options on our user account creation and just allow the user to add or change this information at a later date, after they've set up an account and authenticated.

## V3: Cross-Site Scripting (XSS)
### Exposure
We found an instance of [vulnerability 2] by typing some relevant code into some vulnerable field OR by doing some edge-case thing.

By exploiting [this vulnerability], we were able to retrieve XYZ attributes from the site / access to some unauthorized part of the site / something else valuable.

### Repair
problem_file1.py and problem_file2.py contained the vulnerability. We were able to fix the first with the following adjustment(s):

problem_file1.py

Some body of relevant code that solves our problem
problem_file2.py

Some body of relevant code that solves our problem

## V4: Insecure Direct Oject References
### Exposure
We found an instance of [vulnerability 2] by typing some relevant code into some vulnerable field OR by doing some edge-case thing.

By exploiting [this vulnerability], we were able to retrieve XYZ attributes from the site / access to some unauthorized part of the site / something else valuable.

### Repair
problem_file1.py and problem_file2.py contained the vulnerability. We were able to fix the first with the following adjustment(s):

problem_file1.py

Some body of relevant code that solves our problem
problem_file2.py

Some body of relevant code that solves our problem